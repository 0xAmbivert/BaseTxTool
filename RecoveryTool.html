<!DOCTYPE html>
<html>
<head>
    <title>Base WETH Rescue Mission</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body { background: #0d1117; color: #c9d1d9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 40px; text-align: center; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 25px; max-width: 500px; margin: 0 auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn { padding: 15px 25px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 15px; font-size: 16px; transition: 0.2s; }
        .connect { background: #238636; color: white; }
        .rescue { background: #da3633; color: white; }
        .status { margin-top: 20px; font-size: 14px; padding: 10px; border-radius: 4px; background: #000; color: #7ee787; text-align: left; overflow-x: auto; }
        h2 { color: #58a6ff; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üöÅ WETH Rescue Tool</h2>
        <p>This tool forces the Uniswap Router to sweep any "trapped" funds back to your wallet.</p>
        
        <button id="btnConnect" class="btn connect" onclick="connect()">1. CONNECT WALLET</button>
        <button id="btnRescue" class="btn rescue" onclick="rescue()" style="display:none;">2. ATTEMPT NUCLEAR RECOVERY</button>
        
        <div id="logs" class="status">Waiting for connection...</div>
    </div>

<script>
    const ADDR = {
        WETH: "0x4200000000000000000000000000000000000006",
        ROUTER: "0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"
    };

    let signer, userAddr;

    function log(m) {
        document.getElementById("logs").innerHTML += `> ${m}<br>`;
        console.log(m);
    }

    async function connect() {
        if (!window.ethereum) return log("MetaMask not found!");
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddr = await signer.getAddress();
        
        // Check if Router has ANY WETH first
        const wethContract = new ethers.Contract(ADDR.WETH, ["function balanceOf(address) view returns (uint256)"], provider);
        const routerBalance = await wethContract.balanceOf(ADDR.ROUTER);
        
        log("Connected: " + userAddr.substring(0,6) + "...");
        log("Router Total WETH: " + ethers.utils.formatEther(routerBalance));
        
        document.getElementById("btnConnect").style.display = "none";
        document.getElementById("btnRescue").style.display = "block";
    }

    async function rescue() {
        try {
            log("Building recovery transaction...");
            const router = new ethers.Contract(ADDR.ROUTER, ["function execute(bytes commands, bytes[] inputs) payable"], signer);
            
            // WE USE TWO COMMANDS:
            // 0x04 = SWEEP (Takes WETH from Router balance and sends to user)
            // 0x0c = UNWRAP (Takes WETH from Router, turns to ETH, sends to user)
            const commands = "0x040c"; 
            const inputs = [
                // Input for SWEEP (Token, Recipient, MinAmount)
                ethers.utils.defaultAbiCoder.encode(["address", "address", "uint256"], [ADDR.WETH, userAddr, 1]),
                // Input for UNWRAP (Recipient, MinAmount)
                ethers.utils.defaultAbiCoder.encode(["address", "uint256"], [userAddr, 1])
            ];

            log("Requesting signature...");
            // Use a slightly higher gas limit for safety
            const tx = await router.execute(commands, inputs, { gasLimit: 300000 });
            log("Transaction sent! Hash: " + tx.hash);
            
            await tx.wait();
            log("‚úÖ RECOVERY COMPLETE! Check your wallet.");
        } catch (e) {
            log("‚ùå FAILED: The Router is likely empty or a bot took the funds.");
            console.error(e);
        }
    }
</script>
</body>
</html>
